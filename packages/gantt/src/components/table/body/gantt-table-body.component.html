<div class="gantt-table-body-container">
  <ng-container *ngIf="!flatData?.length">
    <ng-container *ngIf="!emptyTemplate">
      <gantt-icon class="empty-icon" iconName="empty"></gantt-icon>
      <div class="empty-text">没有数据</div>
    </ng-container>
    <ng-template [ngTemplateOutlet]="emptyTemplate"></ng-template>
  </ng-container>

  <ng-container *ngIf="flatData && flatData.length > 0">
    <ng-container *ngFor="let data of flatData; trackBy: trackBy">
      <div class="gantt-table-group" [ngClass]="data.class" *ngIf="data.items">
        <div class="gantt-table-group-title" [class.expanded]="data.expanded" (click)="expandGroup(data)">
          <gantt-icon class="expand-icon" [iconName]="data.expanded ? 'angle-down' : 'angle-right'"></gantt-icon>
          <ng-container *ngIf="groupTemplate; else default">
            <ng-template
              [ngTemplateOutlet]="groupTemplate"
              [ngTemplateOutletContext]="{ $implicit: data.origin, group: data.origin }"
            ></ng-template>
          </ng-container>
          <ng-template #default>
            <span class="group-title">{{ data.title }}</span>
          </ng-template>
        </div>
      </div>

      <div
        *ngIf="!data.items"
        (click)="itemClick.emit({ event: $event, selectedValue: data.origin })"
        class="gantt-table-item gantt-table-row"
        [class.gantt-table-item-with-group]="hasGroup"
        [class.gantt-table-item-first-level-group]="data.level === 0 && (data.type | isGanttRangeItem)"
        [style.height.px]="gantt.styles.lineHeight"
        [style.lineHeight.px]="gantt.styles.lineHeight"
        [class.gantt-table-item-active]="ganttUpper.isSelected(data.id)"
      >
        <ng-template
          [ngTemplateOutlet]="rowBeforeTemplate"
          [ngTemplateOutletContext]="{ $implicit: data.origin, item: data.origin }"
        ></ng-template>

        <div class="gantt-table-column" *ngFor="let column of columns; let first = first" [style.width]="column.columnWidth">
          <div
            *ngIf="column?.showExpandIcon || (!hasShowExpandIcon && first)"
            class="gantt-expand-icon"
            [style.marginLeft.px]="data.level * 20"
          >
            <ng-container *ngIf="data.level < gantt.maxLevel - 1 && data.expandable">
              <gantt-icon
                *ngIf="!data.loading"
                class="expand-icon"
                [iconName]="data.expanded ? 'angle-down' : 'angle-right'"
                (click)="expandChildren($event, data)"
              >
              </gantt-icon>
              <gantt-icon *ngIf="data.loading" [iconName]="'loading'"></gantt-icon>
            </ng-container>
          </div>
          <div class="gantt-table-column-content">
            <ng-template
              [ngTemplateOutlet]="column.templateRef"
              [ngTemplateOutletContext]="{ $implicit: data.origin, item: data.origin }"
            ></ng-template>
          </div>
        </div>
        <ng-template
          [ngTemplateOutlet]="rowAfterTemplate"
          [ngTemplateOutletContext]="{ $implicit: data.origin, item: data.origin }"
        ></ng-template>
      </div>
    </ng-container>
  </ng-container>
</div>
