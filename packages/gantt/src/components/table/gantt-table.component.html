<div class="gantt-side-container">
  <div class="gantt-table-header gantt-table-row">
    <div class="header-column gantt-table-column" *ngFor="let column of columnList" [style.width.px]="column.width">
      <ng-container *ngIf="column.headerTemplateRef; else default" [ngTemplateOutlet]="column.headerTemplateRef"></ng-container>
      <ng-template #default>
        {{ column.name }}
      </ng-template>
    </div>
  </div>

  <div class="gantt-table-body">
    <ng-container *ngIf="groups && groups.length > 0; else itemsTemplate">
      <ng-container *ngFor="let group of groups">
        <div class="gantt-table-group">
          <div class="gantt-table-group-title" [class.expand]="group.expand" (click)="expandGroup(group)">
            <gantt-icon class="expand-icon" [iconName]="group.expand ? 'angle-down' : 'angle-right'"></gantt-icon>
            <ng-container *ngIf="groupTemplate; else default">
              <ng-template
                [ngTemplateOutlet]="groupTemplate"
                [ngTemplateOutletContext]="{ $implicit: group.origin, group: group.origin }"
              ></ng-template>
            </ng-container>
            <ng-template #default>
              <span class="group-title">{{ group.title }}</span>
            </ng-template>
          </div>
        </div>

        <ng-container *ngIf="group.expand">
          <ng-template [ngTemplateOutlet]="ganttItems" [ngTemplateOutletContext]="{ items: group.items }"></ng-template>
        </ng-container>
      </ng-container>
    </ng-container>
  </div>
</div>

<ng-template #itemsTemplate>
  <ng-template [ngTemplateOutlet]="ganttItems" [ngTemplateOutletContext]="{ items: items }"></ng-template>
</ng-template>

<ng-template #ganttItems let-items="items">
  <ng-container *ngFor="let item of items">
    <div class="gantt-table-item gantt-table-row" [style.height.px]="ganttRef.styles.lineHeight" [style.lineHeight.px]="ganttRef.styles.lineHeight">
      <div class="item-column gantt-table-column" *ngFor="let column of columnList" [style.width.px]="column.width">
        <ng-template
          [ngTemplateOutlet]="column.templateRef"
          [ngTemplateOutletContext]="{ $implicit: item.origin, item: item.origin }"
        ></ng-template>
      </div>
    </div>

    <ng-container *ngFor="let item of item.children">
      <ng-template [ngTemplateOutlet]="ganttItems" [ngTemplateOutletContext]="{ items: item.children }"></ng-template>
    </ng-container>
  </ng-container>
</ng-template>
