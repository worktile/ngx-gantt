<div class="gantt-side-container">
  <table [style.min-width.px]="minSideWidth" [style.max-width.px]="maxSideWidth">
    <colgroup>
      <col [style.width]="column.width" [style.minWidth]="column.width" *ngFor="let column of columnList" />
    </colgroup>
    <thead>
      <th *ngFor="let column of columnList" [title]="column.name">
        <ng-container *ngIf="column.headerTemplateRef; else default" [ngTemplateOutlet]="column.headerTemplateRef"></ng-container>
        <ng-template #default>
          {{ column.name }}
        </ng-template>
      </th>
    </thead>
    <tbody>
      <ng-container *ngIf="groups && groups.length > 0; else itemsTemplate">
        <ng-container *ngFor="let group of groups">
          <tr class="gantt-table-group">
            <td [attr.colspan]="columnList.length">
              <div class="gantt-table-group-title" [class.expand]="group.expand" (click)="expandGroup(group)">
                <gantt-icon class="expand-icon" [iconName]="group.expand ? 'angle-down' : 'angle-right'"></gantt-icon>
                <ng-container *ngIf="groupTemplate; else default">
                  <ng-template
                    [ngTemplateOutlet]="groupTemplate"
                    [ngTemplateOutletContext]="{ $implicit: group.origin, group: group.origin }"
                  ></ng-template>
                </ng-container>
                <ng-template #default>
                  <span class="group-title">{{ group.title }}</span>
                </ng-template>
              </div>
            </td>
          </tr>

          <ng-container *ngIf="group.expand">
            <ng-template [ngTemplateOutlet]="ganttItems" [ngTemplateOutletContext]="{ items: group.items }"></ng-template>
          </ng-container>
        </ng-container>
      </ng-container>
    </tbody>
  </table>
</div>

<ng-template #itemsTemplate>
  <ng-template [ngTemplateOutlet]="ganttItems" [ngTemplateOutletContext]="{ items: items }"></ng-template>
</ng-template>

<ng-template #ganttItems let-items="items">
  <ng-container *ngFor="let item of items">
    <tr>
      <td *ngFor="let column of columnList">
        <ng-template
          [ngTemplateOutlet]="column.templateRef"
          [ngTemplateOutletContext]="{ $implicit: item.origin, item: item.origin }"
        ></ng-template>
      </td>
    </tr>
    <ng-container *ngFor="let item of item.children">
      <ng-template [ngTemplateOutlet]="ganttItems" [ngTemplateOutletContext]="{ items: item.children }"></ng-template>
    </ng-container>
  </ng-container>
</ng-template>
