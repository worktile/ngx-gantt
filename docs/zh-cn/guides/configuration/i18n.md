---
title: 国际化
path: 'i18n'
order: 420
---

# 国际化

ngx-gantt 支持多语言，内置 6 种语言包，也支持自定义语言包扩展。

## 前置阅读

在深入学习国际化之前，建议先了解：

- [视图体系](../core/views.md) - 理解视图的显示文本
- [全局配置](./global-config.md) - 了解如何配置语言

## 内置语言包

ngx-gantt 内置以下语言包：

| 语言     | 标识符              | 说明     |
| -------- | ------------------- | -------- |
| 简体中文 | `zh-hans` / `zh-cn` | 默认语言 |
| 繁体中文 | `zh-hant` / `zh-tw` | 繁体中文 |
| 英文     | `en-us`             | English  |
| 日文     | `ja-jp`             | 日本語   |
| 德文     | `de-de`             | Deutsch  |
| 俄文     | `ru-ru`             | Русский  |

### 使用内置语言

通过全局配置设置语言：

```typescript
import { GANTT_GLOBAL_CONFIG, GanttI18nLocale } from '@worktile/gantt';

@Component({
  providers: [
    {
      provide: GANTT_GLOBAL_CONFIG,
      useValue: {
        locale: GanttI18nLocale.enUs // 或 'en-us'
      }
    }
  ]
})
export class AppComponent {}
```

## 语言切换

### 全局语言切换

```typescript
import { GanttConfigService } from '@worktile/gantt';

@Component({
  template: `
    <select (change)="changeLanguage($event)">
      <option value="zh-hans">简体中文</option>
      <option value="en-us">English</option>
    </select>

    <ngx-gantt [items]="items"></ngx-gantt>
  `
})
export class MyComponent {
  constructor(private configService: GanttConfigService) {}

  changeLanguage(event: Event) {
    const locale = (event.target as HTMLSelectElement).value;
    this.configService.setLocale(locale);
  }
}
```

## 自定义语言包

### 创建自定义语言包

```typescript
import { GanttI18nLocaleConfig, GanttViewType } from '@worktile/gantt';
import { zhCN } from 'date-fns/locale';

const customLocale: GanttI18nLocaleConfig = {
  id: 'custom-locale',
  dateLocale: zhCN, // date-fns 的 locale
  views: {
    [GanttViewType.hour]: {
      label: '小时视图',
      tickFormats: {
        period: 'M月d日',
        unit: 'HH:mm'
      }
    },
    [GanttViewType.day]: {
      label: '日视图',
      tickFormats: {
        period: 'yyyy年MM月',
        unit: 'd'
      }
    },
    [GanttViewType.week]: {
      label: '周视图',
      tickFormats: {
        period: 'yyyy年',
        unit: '第w周'
      }
    },
    [GanttViewType.month]: {
      label: '月视图',
      tickFormats: {
        period: `yyyy年'Q'Q`,
        unit: 'M月'
      }
    },
    [GanttViewType.quarter]: {
      label: '季度视图',
      tickFormats: {
        period: 'yyyy年',
        unit: `yyyy年'Q'Q`
      }
    },
    [GanttViewType.year]: {
      label: '年视图',
      tickFormats: {
        unit: 'yyyy年'
      }
    }
  }
};
```

### 注册自定义语言包

使用 `GANTT_I18N_LOCALE_TOKEN` 注册：

```typescript
import { GANTT_I18N_LOCALE_TOKEN, GANTT_GLOBAL_CONFIG, GanttI18nLocaleConfig } from '@worktile/gantt';

@Component({
  providers: [
    {
      provide: GANTT_I18N_LOCALE_TOKEN,
      useValue: customLocale,
      multi: true
    },
    {
      provide: GANTT_GLOBAL_CONFIG,
      useValue: {
        locale: 'custom-locale' // 使用自定义语言包 ID
      }
    }
  ]
})
export class AppComponent {}
```

### 覆盖内置语言包

使用相同的 ID 可以覆盖内置语言包：

```typescript
const customZhHans: GanttI18nLocaleConfig = {
  id: GanttI18nLocale.zhHans, // 使用内置 ID
  views: {
    [GanttViewType.day]: {
      label: '天', // 覆盖标签
      tickFormats: {
        period: 'yyyy-MM', // 覆盖格式
        unit: 'dd'
      }
    }
    // ... 其他视图
  }
};

@Component({
  providers: [
    {
      provide: GANTT_I18N_LOCALE_TOKEN,
      useValue: customZhHans,
      multi: true
    }
  ]
})
export class AppComponent {}
```

## 语言包结构

### GanttI18nLocaleConfig

```typescript
interface GanttI18nLocaleConfig {
  id: string; // 语言标识符
  dateLocale?: DateFnsLocale; // date-fns 的 locale（可选）
  views: {
    // 视图配置
    [GanttViewType]: {
      label: string; // 视图标签
      tickFormats: {
        // 时间刻度格式
        period?: string; // 周期刻度格式
        unit?: string; // 单位刻度格式
      };
    };
  };
}
```

### tickFormats 格式

使用 `date-fns` 的格式字符串：

- `'yyyy'` - 年份（4 位）
- `'MM'` - 月份（2 位）
- `'dd'` - 日期（2 位）
- `'HH:mm'` - 小时:分钟
- `'wo'` - 周序号
- `'Q'` - 季度

## 最小示例

### 使用内置语言

```typescript
import { Component } from '@angular/core';
import { GANTT_GLOBAL_CONFIG, GanttI18nLocale, GanttItem } from '@worktile/gantt';

@Component({
  providers: [
    {
      provide: GANTT_GLOBAL_CONFIG,
      useValue: {
        locale: GanttI18nLocale.enUs
      }
    }
  ],
  template: `<ngx-gantt [items]="items"></ngx-gantt>`
})
export class AppComponent {
  items: GanttItem[] = [];
}
```

### 自定义语言包

```typescript
import { Component } from '@angular/core';
import { GANTT_I18N_LOCALE_TOKEN, GANTT_GLOBAL_CONFIG, GanttI18nLocaleConfig, GanttViewType } from '@worktile/gantt';
import { zhCN } from 'date-fns/locale';

const myLocale: GanttI18nLocaleConfig = {
  id: 'my-locale',
  dateLocale: zhCN,
  views: {
    [GanttViewType.day]: {
      label: '日',
      tickFormats: {
        period: 'yyyy年MM月',
        unit: 'd'
      }
    }
    // ... 其他视图
  }
};

@Component({
  providers: [
    {
      provide: GANTT_I18N_LOCALE_TOKEN,
      useValue: myLocale,
      multi: true
    },
    {
      provide: GANTT_GLOBAL_CONFIG,
      useValue: {
        locale: 'my-locale'
      }
    }
  ],
  template: `<ngx-gantt [items]="items"></ngx-gantt>`
})
export class AppComponent {
  items: GanttItem[] = [];
}
```

## 常见问题

### Q: 语言切换不生效？

**A:** 检查：

1. 是否调用了 `configService.setLocale()`
2. 语言包是否正确注册
3. 语言 ID 是否匹配

### Q: 如何只覆盖部分视图的文本？

**A:** 在自定义语言包中只定义需要覆盖的视图：

```typescript
const partialLocale: GanttI18nLocaleConfig = {
  id: GanttI18nLocale.zhHans,
  views: {
    [GanttViewType.day]: {
      label: '自定义日视图',
      tickFormats: {
        period: 'yyyy-MM',
        unit: 'dd'
      }
    }
    // 其他视图使用默认值
  }
};
```

### Q: dateLocale 是必需的吗？

**A:** 不是必需的，但建议提供以确保日期格式化正确。

## 相关链接

- [全局配置](./global-config.md) - 了解如何配置语言
- [视图体系](../core/views.md) - 了解视图的显示
- [date-fns 文档](https://date-fns.org/docs/format) - 了解日期格式字符串
